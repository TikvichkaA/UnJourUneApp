import{j as e,m,u as N,r as y}from"./index-C4qqbxA3.js";import{u as M,C as k,f as S,a as L,b as q,c as P}from"./CameraControls-CGnJSejw.js";import{c as B}from"./middleware-EJ6QVAsm.js";function D({turn:l,isCheck:a=!1,isCheckmate:s=!1,isStalemate:t=!1,moveHistory:i=[],onUndo:o,onReset:n,onResetCamera:r,showControls:d=!0}){const{showLegalMoves:h,showLastMove:x,showThreats:v,toggleLegalMoves:w,toggleLastMove:p,toggleThreats:g}=M(),f=l==="w"?"Blancs":"Noirs",b=s?`Échec et mat ! ${l==="w"?"Noirs":"Blancs"} gagnent`:t?"Pat !":a?`Échec au Roi ${f.toLowerCase()}`:`Au tour des ${f.toLowerCase()}`;return e.jsxs(e.Fragment,{children:[e.jsx(m.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"absolute top-4 left-1/2 -translate-x-1/2 glass px-6 py-3 rounded-xl",children:e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-4 h-4 rounded-full ${l==="w"?"bg-chess-white":"bg-chess-black"} border border-wood-accent`}),e.jsx("span",{className:`font-medium ${s||t?"text-chess-danger":a?"text-yellow-400":"text-wood-light"}`,children:b})]})})}),i.length>0&&e.jsxs(m.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"absolute left-4 top-20 glass rounded-xl p-4 max-h-[300px] overflow-y-auto w-48",children:[e.jsx("h3",{className:"text-wood-accent text-sm font-medium mb-2",children:"Historique"}),e.jsx("div",{className:"space-y-1",children:i.reduce((c,u,C)=>(C%2===0?c.push([u]):c[c.length-1].push(u),c),[]).map((c,u)=>e.jsxs("div",{className:"flex text-sm",children:[e.jsxs("span",{className:"text-wood-dark w-6",children:[u+1,"."]}),e.jsx("span",{className:"text-wood-light w-12",children:c[0]}),c[1]&&e.jsx("span",{className:"text-wood-light",children:c[1]})]},u))})]}),d&&e.jsxs(m.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"absolute right-4 top-20 space-y-3",children:[e.jsxs("div",{className:"glass rounded-xl p-3 space-y-2",children:[e.jsxs("button",{onClick:r,className:"w-full btn-secondary text-sm py-2 flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"Caméra"]}),o&&e.jsxs("button",{onClick:o,disabled:i.length===0,className:"w-full btn-secondary text-sm py-2 flex items-center justify-center gap-2 disabled:opacity-50",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})}),"Annuler"]}),n&&e.jsxs("button",{onClick:n,className:"w-full btn-secondary text-sm py-2 flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Rejouer"]})]}),e.jsxs("div",{className:"glass rounded-xl p-3 space-y-2",children:[e.jsx("h4",{className:"text-wood-accent text-xs font-medium mb-2",children:"Affichage"}),e.jsx(j,{label:"Coups légaux",active:h,onClick:w}),e.jsx(j,{label:"Dernier coup",active:x,onClick:p}),e.jsx(j,{label:"Menaces",active:v,onClick:g})]})]})]})}function j({label:l,active:a,onClick:s}){return e.jsx("button",{onClick:s,className:`w-full text-left px-3 py-1.5 rounded text-sm transition-colors ${a?"bg-wood-medium/30 text-wood-light":"text-wood-dark hover:text-wood-accent"}`,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${a?"bg-green-400":"bg-gray-500"}`}),l]})})}const R=B((l,a)=>({game:new k,fen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",history:[],selectedSquare:null,legalMoves:[],lastMove:null,isCheck:!1,isCheckmate:!1,isStalemate:!1,isDraw:!1,turn:"w",initGame:s=>{const t=new k(s);l({game:t,fen:t.fen(),history:[],selectedSquare:null,legalMoves:[],lastMove:null,isCheck:t.isCheck(),isCheckmate:t.isCheckmate(),isStalemate:t.isStalemate(),isDraw:t.isDraw(),turn:t.turn()})},selectSquare:s=>{const{game:t,selectedSquare:i,legalMoves:o}=a();if(i&&o.includes(s)){a().makeMove(i,s);return}const n=t.get(s);if(n&&n.color===t.turn()){const r=t.moves({square:s,verbose:!0});l({selectedSquare:s,legalMoves:r.map(d=>d.to)})}else l({selectedSquare:null,legalMoves:[]})},makeMove:(s,t,i="q")=>{const{game:o}=a();try{const n=o.move({from:s,to:t,promotion:i});if(n)return l({fen:o.fen(),history:[...a().history,n.san],selectedSquare:null,legalMoves:[],lastMove:{from:n.from,to:n.to},isCheck:o.isCheck(),isCheckmate:o.isCheckmate(),isStalemate:o.isStalemate(),isDraw:o.isDraw(),turn:o.turn()}),n}catch{}return l({selectedSquare:null,legalMoves:[]}),null},undoMove:()=>{const{game:s,history:t}=a();s.undo()&&l({fen:s.fen(),history:t.slice(0,-1),selectedSquare:null,legalMoves:[],lastMove:null,isCheck:s.isCheck(),isCheckmate:s.isCheckmate(),isStalemate:s.isStalemate(),isDraw:s.isDraw(),turn:s.turn()})},resetGame:()=>{a().initGame()},getLegalMovesForSquare:s=>{const{game:t}=a();return t.moves({square:s,verbose:!0}).map(o=>o.to)},isLegalMove:(s,t)=>{const{game:i}=a();return i.moves({square:s,verbose:!0}).some(n=>n.to===t)},getPieceAt:s=>{const{game:t}=a();return t.get(s)||null}}));function T(){const l=N(),{fen:a,selectedSquare:s,legalMoves:t,lastMove:i,history:o,isCheck:n,isCheckmate:r,isStalemate:d,turn:h,initGame:x,selectSquare:v,undoMove:w,resetGame:p}=R();y.useEffect(()=>{x()},[x]);const g=y.useCallback(()=>{window.resetChessCamera&&window.resetChessCamera()},[]),f=n?S(a,h):null;return e.jsxs("div",{className:"h-screen w-screen relative overflow-hidden",children:[e.jsxs(m.button,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},onClick:()=>l("/"),className:"absolute top-4 left-4 z-10 glass px-4 py-2 rounded-xl flex items-center gap-2 hover:border-wood-accent transition-colors",children:[e.jsx("svg",{className:"w-5 h-5 text-wood-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),e.jsx("span",{className:"text-wood-light",children:"Retour"})]}),e.jsxs(L,{shadows:!0,camera:{position:[0,8,10],fov:45},gl:{antialias:!0},children:[e.jsx("ambientLight",{intensity:.4}),e.jsx("directionalLight",{position:[10,15,10],intensity:1,castShadow:!0,"shadow-mapSize":[2048,2048],"shadow-camera-far":50,"shadow-camera-left":-10,"shadow-camera-right":10,"shadow-camera-top":10,"shadow-camera-bottom":-10}),e.jsx("directionalLight",{position:[-5,10,-5],intensity:.3}),e.jsx("pointLight",{position:[0,5,0],intensity:.2}),e.jsx("fog",{attach:"fog",args:["#1a0f0a",15,40]}),e.jsx(q,{fen:a,selectedSquare:s,legalMoves:t,lastMove:i,onSquareClick:v,isCheck:n,checkSquare:f}),e.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,-.3,0],receiveShadow:!0,children:[e.jsx("planeGeometry",{args:[50,50]}),e.jsx("meshStandardMaterial",{color:"#1a0f0a",roughness:.9})]}),e.jsx(P,{onResetCamera:g})]}),e.jsx(D,{turn:h,isCheck:n,isCheckmate:r,isStalemate:d,moveHistory:o,onUndo:w,onReset:p,onResetCamera:g}),(r||d)&&e.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},className:"absolute inset-0 bg-black/50 flex items-center justify-center z-20",children:e.jsxs(m.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"glass rounded-2xl p-8 text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-display font-bold text-wood-light mb-2",children:r?h==="w"?"Victoire des Noirs !":"Victoire des Blancs !":"Partie nulle !"}),e.jsx("p",{className:"text-wood-accent mb-6",children:r?"Échec et mat":"Pat"}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx("button",{onClick:p,className:"btn-primary",children:"Rejouer"}),e.jsx("button",{onClick:()=>l("/"),className:"btn-secondary",children:"Menu"})]})]})})]})}export{T as default};
