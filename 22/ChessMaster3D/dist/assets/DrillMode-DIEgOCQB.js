import{u as T,r as s,j as e,m as r}from"./index-C4qqbxA3.js";import{C as q,f as G,a as H,b as J,c as O}from"./CameraControls-CGnJSejw.js";import{u as U}from"./progressStore-B8khYM18.js";import{A as Q}from"./index-CC1_5B0R.js";import"./middleware-EJ6QVAsm.js";const V=[{id:"mate_in_1",title:"Mat en 1",description:"Trouvez le mat en un coup",difficulty:"beginner",puzzles:[{id:"M1_01",fen:"6k1/5ppp/8/8/8/8/8/R3K3 w Q - 0 1",solution:["Ra8#"],theme:"back_rank"},{id:"M1_02",fen:"5rk1/5Npp/8/8/8/8/8/4K2R w - - 0 1",solution:["Rh8#"],theme:"back_rank"},{id:"M1_03",fen:"6k1/4Rppp/8/8/8/8/8/4K3 w - - 0 1",solution:["Re8#"],theme:"back_rank"},{id:"M1_04",fen:"r1bqk2r/pppp1Qpp/2n2n2/2b1p3/2B1P3/8/PPPP1PPP/RNB1K1NR w KQkq - 0 1",solution:["Qxf7#"],theme:"queen_mate"},{id:"M1_05",fen:"rnb1kbnr/pppp1ppp/8/4p3/6Pq/5P2/PPPPP2P/RNBQKBNR w KQkq - 0 1",solution:["g5"],theme:"defense"},{id:"M1_06",fen:"r1bqkb1r/pppp1ppp/2n2n2/4p2Q/2B1P3/8/PPPP1PPP/RNB1K1NR w KQkq - 0 1",solution:["Qxf7#"],theme:"scholars_mate"},{id:"M1_07",fen:"rnbqkbnr/ppppp2p/5p2/6pQ/4P3/8/PPPP1PPP/RNB1KBNR w KQkq - 0 1",solution:["Qh5#"],theme:"queen_mate"},{id:"M1_08",fen:"r1bqkb1r/pppp1Npp/2n2n2/4p3/2B1P3/8/PPPP1PPP/RNBQK2R w KQkq - 0 1",solution:["Qh5+"],theme:"knight_queen"}]},{id:"fork_training",title:"Fourchettes",description:"Attaquez deux pièces à la fois",difficulty:"beginner",puzzles:[{id:"F_01",fen:"r1bqkbnr/pppp1ppp/2n5/4p3/4P3/5N2/PPPP1PPP/RNBQKB1R w KQkq - 2 3",solution:["Ng5"],theme:"knight_fork"},{id:"F_02",fen:"r1bqkb1r/pppp1ppp/2n2n2/4p3/2B1P3/5N2/PPPP1PPP/RNBQK2R w KQkq - 4 4",solution:["Ng5"],theme:"knight_fork"},{id:"F_03",fen:"r2qkbnr/ppp2ppp/2np4/4p3/2B1P1b1/5N1P/PPPP1PP1/RNBQK2R w KQkq - 0 5",solution:["hxg4"],theme:"pawn_fork"},{id:"F_04",fen:"r1bqkb1r/1ppp1ppp/p1n2n2/4p3/B3P3/5N2/PPPP1PPP/RNBQK2R w KQkq - 0 4",solution:["Bxc6"],theme:"bishop_attack"},{id:"F_05",fen:"rnbqk2r/pppp1ppp/5n2/2b1p3/2B1P3/5N2/PPPP1PPP/RNBQK2R w KQkq - 4 4",solution:["Ng5"],theme:"knight_fork"}]},{id:"pin_training",title:"Clouages",description:"Immobilisez les pièces adverses",difficulty:"intermediate",puzzles:[{id:"P_01",fen:"r1bqkbnr/pppp1ppp/2n5/4p3/4P3/5N2/PPPP1PPP/RNBQKB1R w KQkq - 2 3",solution:["Bb5"],theme:"absolute_pin"},{id:"P_02",fen:"rnbqk2r/pppp1ppp/5n2/2b1p3/2B1P3/5N2/PPPP1PPP/RNBQK2R w KQkq - 4 4",solution:["d3"],theme:"relative_pin"},{id:"P_03",fen:"r1bqkb1r/pppp1ppp/2n2n2/4p3/2B1P3/5N2/PPPP1PPP/RNBQK2R w KQkq - 4 4",solution:["Bg5"],theme:"pin_knight"},{id:"P_04",fen:"rnbqkbnr/ppp2ppp/4p3/3p4/3PP3/8/PPP2PPP/RNBQKBNR w KQkq - 0 3",solution:["Bb5+"],theme:"absolute_pin"}]},{id:"endgame_basics",title:"Finales de Base",description:"Maîtrisez les finales essentielles",difficulty:"intermediate",puzzles:[{id:"E_01",fen:"8/8/4k3/8/4P3/4K3/8/8 w - - 0 1",solution:["Kf4"],theme:"opposition"},{id:"E_02",fen:"8/8/8/4k3/8/4K3/4P3/8 w - - 0 1",solution:["Kf3"],theme:"key_squares"},{id:"E_03",fen:"8/5k2/8/8/8/8/4PK2/8 w - - 0 1",solution:["Ke3"],theme:"king_activation"},{id:"E_04",fen:"8/8/3k4/8/3KP3/8/8/8 w - - 0 1",solution:["e5+"],theme:"pawn_advance"}]}],X={drillSets:V};function ne(){const M=T(),{completeDrill:P,currentStreak:S}=U(),[l,k]=s.useState(null),[d,g]=s.useState(0),[n,C]=s.useState(null),[a,p]=s.useState(null),[j,m]=s.useState([]),[L,_]=s.useState(null),[z,D]=s.useState(0),[u,x]=s.useState({correct:0,total:0}),[B,h]=s.useState(0),[c,w]=s.useState(null),[E,N]=s.useState(!1),o=s.useMemo(()=>l?l.puzzles[d]:null,[l,d]);s.useEffect(()=>{if(o){const t=new q(o.fen);C(t),p(null),m([]),_(null),w(null),D(Date.now())}},[o]);const F=s.useCallback(t=>{if(!n||!o||c)return;if(a&&j.includes(t)){const b=`${a}${t}`,v=o.solution.some(i=>{const $=new q(o.fen);try{const y=$.move(i);return y&&`${y.from}${y.to}`===b}catch{return!1}}),R=Date.now()-z;v?(n.move({from:a,to:t}),_({from:a,to:t}),w("correct"),x(i=>({correct:i.correct+1,total:i.total+1})),h(i=>i+1),P(o.id,!0,R)):(w("wrong"),x(i=>({...i,total:i.total+1})),h(0),P(o.id,!1,R)),p(null),m([]),setTimeout(()=>{l&&d<l.puzzles.length-1?g(i=>i+1):N(!0)},1500);return}const f=n.get(t);if(f&&f.color===n.turn()){const b=n.moves({square:t,verbose:!0});p(t),m(b.map(v=>v.to))}else p(null),m([])},[n,o,a,j,z,l,d,P,c]),W=t=>{k(t),g(0),x({correct:0,total:0}),h(0),N(!1)},A=()=>{l&&(g(0),x({correct:0,total:0}),h(0),N(!1))};if(!l)return e.jsxs("div",{className:"min-h-screen p-6",children:[e.jsxs(r.header,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"max-w-4xl mx-auto mb-8",children:[e.jsxs("button",{onClick:()=>M("/"),className:"flex items-center gap-2 text-wood-accent hover:text-wood-light transition-colors mb-4",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Retour"]}),e.jsx("h1",{className:"text-3xl font-display font-bold text-wood-light",children:"Entraînement Tactique"}),e.jsx("p",{className:"text-wood-accent mt-1",children:"Choisissez un type de puzzle"})]}),e.jsx(r.main,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.1},className:"max-w-4xl mx-auto grid gap-4",children:X.drillSets.map((t,f)=>e.jsx(r.button,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:f*.1},onClick:()=>W(t),className:"glass rounded-2xl p-6 text-left hover:border-wood-medium transition-all group",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-medium text-wood-light group-hover:text-yellow-400 transition-colors",children:t.title}),e.jsx("p",{className:"text-wood-accent mt-1",children:t.description}),e.jsxs("div",{className:"flex items-center gap-4 mt-3",children:[e.jsxs("span",{className:"text-sm text-wood-dark",children:[t.puzzles.length," puzzles"]}),e.jsx("span",{className:`text-sm px-2 py-0.5 rounded ${t.difficulty==="beginner"?"bg-green-500/20 text-green-400":t.difficulty==="intermediate"?"bg-yellow-500/20 text-yellow-400":"bg-red-500/20 text-red-400"}`,children:t.difficulty==="beginner"?"Débutant":t.difficulty==="intermediate"?"Intermédiaire":"Avancé"})]})]}),e.jsx("div",{className:"w-12 h-12 rounded-full bg-wood-medium/20 flex items-center justify-center group-hover:bg-wood-medium/40 transition-colors",children:e.jsxs("svg",{className:"w-6 h-6 text-wood-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]})})]})},t.id))})]});if(!n||!o)return null;const K=n.isCheck(),I=K?G(n.fen(),n.turn()):null;return e.jsxs("div",{className:"h-screen w-screen relative overflow-hidden",children:[e.jsxs(r.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"absolute top-4 left-4 right-4 z-10 flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>k(null),className:"glass px-4 py-2 rounded-xl flex items-center gap-2 hover:border-wood-accent transition-colors",children:[e.jsx("svg",{className:"w-5 h-5 text-wood-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),e.jsx("span",{className:"text-wood-light",children:"Quitter"})]}),e.jsx("div",{className:"glass px-6 py-3 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-wood-accent",children:"Puzzle"}),e.jsxs("p",{className:"text-lg font-medium text-wood-light",children:[d+1,"/",l.puzzles.length]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-wood-accent",children:"Score"}),e.jsxs("p",{className:"text-lg font-medium text-green-400",children:[u.correct,"/",u.total]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-wood-accent",children:"Série"}),e.jsx("p",{className:"text-lg font-medium text-yellow-400",children:B})]})]})})]}),e.jsxs(H,{shadows:!0,camera:{position:[0,8,10],fov:45},gl:{antialias:!0},children:[e.jsx("ambientLight",{intensity:.4}),e.jsx("directionalLight",{position:[10,15,10],intensity:1,castShadow:!0,"shadow-mapSize":[2048,2048]}),e.jsx("directionalLight",{position:[-5,10,-5],intensity:.3}),e.jsx("fog",{attach:"fog",args:["#1a0f0a",15,40]}),e.jsx(J,{fen:n.fen(),selectedSquare:a,legalMoves:j,lastMove:L,onSquareClick:F,isCheck:K,checkSquare:I,interactive:!c}),e.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,-.3,0],receiveShadow:!0,children:[e.jsx("planeGeometry",{args:[50,50]}),e.jsx("meshStandardMaterial",{color:"#1a0f0a",roughness:.9})]}),e.jsx(O,{})]}),e.jsx(Q,{children:c&&e.jsx(r.div,{initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.5},className:"absolute inset-0 flex items-center justify-center pointer-events-none z-20",children:e.jsx("div",{className:`w-32 h-32 rounded-full flex items-center justify-center ${c==="correct"?"bg-green-500":"bg-red-500"}`,children:c==="correct"?e.jsx("svg",{className:"w-16 h-16 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})}):e.jsx("svg",{className:"w-16 h-16 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M6 18L18 6M6 6l12 12"})})})})}),e.jsx(Q,{children:E&&e.jsx(r.div,{initial:{opacity:0},animate:{opacity:1},className:"absolute inset-0 bg-black/60 flex items-center justify-center z-20",children:e.jsxs(r.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"glass rounded-2xl p-8 max-w-md text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-wood-medium to-yellow-500 flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-10 h-10 text-wood-dark",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"})})}),e.jsx("h2",{className:"text-2xl font-display font-bold text-wood-light mb-2",children:"Session terminée !"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 my-6",children:[e.jsxs("div",{className:"glass-light rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-wood-accent",children:"Précision"}),e.jsxs("p",{className:"text-2xl font-bold text-green-400",children:[Math.round(u.correct/u.total*100),"%"]})]}),e.jsxs("div",{className:"glass-light rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-wood-accent",children:"Meilleure série"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-400",children:Math.max(B,S)})]})]}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx("button",{onClick:A,className:"btn-secondary",children:"Recommencer"}),e.jsx("button",{onClick:()=>k(null),className:"btn-primary",children:"Autres puzzles"})]})]})})})]})}export{ne as default};
